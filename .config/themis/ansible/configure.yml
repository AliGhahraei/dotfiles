- name: "Configure"
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:
  - name: "Include autogenerated variables"
    ansible.builtin.include_vars:
      file: autogen_variables.yml

  - name: "Update aconfmgr"
    ansible.builtin.git:
      repo: 'https://aur.archlinux.org/aconfmgr-git.git'
      dest: '{{ git_projects }}/aconfmgr'
      force: true

  - name: "Build & install aconfmgr"
    ansible.builtin.command:
      argv:
        - /usr/bin/makepkg
        - --noconfirm
        - -si
    args:
      chdir: '{{ git_projects }}/aconfmgr'

  - name: "Apply aconfmgr config"
    ansible.builtin.command:
      argv:
        - /usr/bin/aconfmgr
        - apply
